import React, { useState, useEffect } from 'react';
import { Car, MapPin, Clock, Users, DollarSign, Calendar, Phone, Search, Plus, ArrowRight, UserCircle, Bell, Settings, Home, Star, Navigation, Shield, Zap, TrendingDown } from 'lucide-react';

const CampusCabShare = () => {
  const [currentView, setCurrentView] = useState('home');
  const [userType, setUserType] = useState('passenger');
  const [rideRequest, setRideRequest] = useState({
    from: 'Main Campus Gate',
    to: '',
    time: '',
    seats: 1
  });
  const [availableRides, setAvailableRides] = useState([]);
  const [myRides, setMyRides] = useState([]);
  const [showBookingConfirm, setShowBookingConfirm] = useState(false);
  const [selectedRide, setSelectedRide] = useState(null);

  // Mock data for available rides
  const mockRides = [
    {
      id: 1,
      driver: 'Priya Sharma',
      rating: 4.8,
      totalTrips: 45,
      from: 'Main Campus',
      to: 'Vaishali Nagar',
      time: '2:30 PM',
      availableSeats: 3,
      fare: 40,
      vehicle: 'Honda City - RJ14 AB 1234',
      route: 'Via MI Road → Statue Circle',
      distance: '8.5 km',
      duration: '20 min',
      verified: true
    },
    {
      id: 2,
      driver: 'Rahul Verma',
      rating: 4.9,
      totalTrips: 67,
      from: 'Main Campus',
      to: 'Malviya Nagar',
      time: '2:45 PM',
      availableSeats: 2,
      fare: 35,
      vehicle: 'Maruti Swift - RJ14 CD 5678',
      route: 'Via Tonk Road → Jawahar Circle',
      distance: '7.2 km',
      duration: '18 min',
      verified: true
    },
    {
      id: 3,
      driver: 'Ananya Joshi',
      rating: 4.7,
      totalTrips: 34,
      from: 'Main Campus',
      to: 'C-Scheme',
      time: '3:00 PM',
      availableSeats: 4,
      fare: 30,
      vehicle: 'Hyundai i20 - RJ14 EF 9012',
      route: 'Via JLN Marg → Rambagh Circle',
      distance: '6.8 km',
      duration: '15 min',
      verified: true
    },
    {
      id: 4,
      driver: 'Karan Mehra',
      rating: 4.8,
      totalTrips: 52,
      from: 'Main Campus',
      to: 'Mansarovar',
      time: '2:15 PM',
      availableSeats: 3,
      fare: 45,
      vehicle: 'Toyota Etios - RJ14 GH 3456',
      route: 'Via Tonk Road → Shipra Path',
      distance: '9.8 km',
      duration: '25 min',
      verified: true
    }
  ];

  const popularDestinations = [
    { name: 'Vaishali Nagar', rides: 12 },
    { name: 'Malviya Nagar', rides: 15 },
    { name: 'C-Scheme', rides: 8 },
    { name: 'Raja Park', rides: 10 },
    { name: 'Mansarovar', rides: 14 },
    { name: 'Jagatpura', rides: 9 },
    { name: 'Tonk Road', rides: 11 },
    { name: 'Civil Lines', rides: 7 }
  ];

  const handleFindRides = () => {
    if (!rideRequest.to) {
      alert('Please enter a destination');
      return;
    }
    const filtered = mockRides.filter(ride => 
      ride.to.toLowerCase().includes(rideRequest.to.toLowerCase())
    );
    setAvailableRides(filtered.length > 0 ? filtered : mockRides);
    setCurrentView('results');
  };

  const handleBookRide = (ride) => {
    setSelectedRide(ride);
    setShowBookingConfirm(true);
  };

  const confirmBooking = () => {
    const bookedRide = {
      ...selectedRide,
      status: 'confirmed',
      bookingId: `BK${Date.now().toString().slice(-8)}`,
      passengerCount: rideRequest.seats,
      bookedAt: new Date().toLocaleTimeString(),
      pickupPoint: rideRequest.from
    };
    setMyRides([bookedRide, ...myRides]);
    setShowBookingConfirm(false);
    setSelectedRide(null);
    setCurrentView('myrides');
  };

  const HomeView = () => (
    <div className="space-y-6">
      {/* Hero Section */}
      <div className="bg-gradient-to-br from-blue-600 via-purple-600 to-pink-500 rounded-2xl p-8 text-white shadow-xl">
        <div className="flex items-center gap-2 mb-3">
          <Car className="w-8 h-8" />
          <h1 className="text-3xl font-bold">Campus Cab Share</h1>
        </div>
        <p className="text-blue-100 mb-2">Smart ride-sharing for students</p>
        <div className="flex items-center gap-4 text-sm">
          <span className="flex items-center gap-1">
            <Users className="w-4 h-4" /> 2.5k+ Students
          </span>
          <span className="flex items-center gap-1">
            <TrendingDown className="w-4 h-4" /> 70% Savings
          </span>
        </div>
      </div>

      {/* Search Card */}
      <div className="bg-white rounded-2xl p-6 shadow-lg border border-gray-100">
        <div className="flex gap-2 mb-6">
          <button 
            className={`flex-1 py-3 px-4 rounded-xl font-medium transition-all ${userType === 'passenger' ? 'bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-md' : 'bg-gray-100 text-gray-600'}`}
            onClick={() => setUserType('passenger')}
          >
            <Search className="w-4 h-4 inline mr-2" />
            Find Ride
          </button>
          <button 
            className={`flex-1 py-3 px-4 rounded-xl font-medium transition-all ${userType === 'driver' ? 'bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-md' : 'bg-gray-100 text-gray-600'}`}
            onClick={() => setUserType('driver')}
          >
            <Plus className="w-4 h-4 inline mr-2" />
            Offer Ride
          </button>
        </div>

        <div className="space-y-4">
          <div>
            <label className="block text-sm font-semibold mb-2 text-gray-700">Pickup Location</label>
            <div className="relative">
              <MapPin className="absolute left-4 top-4 w-5 h-5 text-blue-600" />
              <input
                type="text"
                value={rideRequest.from}
                onChange={(e) => setRideRequest({...rideRequest, from: e.target.value})}
                className="w-full pl-12 pr-4 py-3.5 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
                placeholder="Main Campus Gate"
              />
            </div>
          </div>

          <div>
            <label className="block text-sm font-semibold mb-2 text-gray-700">Drop Location</label>
            <div className="relative">
              <Navigation className="absolute left-4 top-4 w-5 h-5 text-purple-600" />
              <input
                type="text"
                placeholder="Where are you going?"
                value={rideRequest.to}
                onChange={(e) => setRideRequest({...rideRequest, to: e.target.value})}
                className="w-full pl-12 pr-4 py-3.5 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition"
              />
            </div>
          </div>

          <div className="grid grid-cols-2 gap-4">
            <div>
              <label className="block text-sm font-semibold mb-2 text-gray-700">Time</label>
              <div className="relative">
                <Clock className="absolute left-4 top-4 w-5 h-5 text-orange-500" />
                <input
                  type="time"
                  value={rideRequest.time}
                  onChange={(e) => setRideRequest({...rideRequest, time: e.target.value})}
                  className="w-full pl-12 pr-4 py-3.5 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition"
                />
              </div>
            </div>

            <div>
              <label className="block text-sm font-semibold mb-2 text-gray-700">Seats</label>
              <div className="relative">
                <Users className="absolute left-4 top-4 w-5 h-5 text-green-500" />
                <select
                  value={rideRequest.seats}
                  onChange={(e) => setRideRequest({...rideRequest, seats: parseInt(e.target.value)})}
                  className="w-full pl-12 pr-4 py-3.5 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500 transition appearance-none bg-white"
                >
                  {[1,2,3,4].map(n => <option key={n} value={n}>{n}</option>)}
                </select>
              </div>
            </div>
          </div>

          <button 
            onClick={handleFindRides}
            className="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-4 rounded-xl font-semibold hover:from-blue-700 hover:to-purple-700 transition-all shadow-lg hover:shadow-xl flex items-center justify-center gap-2"
          >
            <Search className="w-5 h-5" />
            Search Available Rides
          </button>
        </div>
      </div>

      {/* Impact Stats */}
      <div className="grid grid-cols-3 gap-3">
        <div className="bg-gradient-to-br from-green-50 to-green-100 rounded-xl p-4 text-center border border-green-200">
          <DollarSign className="w-6 h-6 text-green-600 mx-auto mb-1" />
          <div className="text-2xl font-bold text-green-700">₹35</div>
          <div className="text-xs text-green-600 font-medium">Avg. Fare</div>
        </div>
        <div className="bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl p-4 text-center border border-blue-200">
          <Users className="w-6 h-6 text-blue-600 mx-auto mb-1" />
          <div className="text-2xl font-bold text-blue-700">2.5k+</div>
          <div className="text-xs text-blue-600 font-medium">Students</div>
        </div>
        <div className="bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl p-4 text-center border border-purple-200">
          <TrendingDown className="w-6 h-6 text-purple-600 mx-auto mb-1" />
          <div className="text-2xl font-bold text-purple-700">70%</div>
          <div className="text-xs text-purple-600 font-medium">Savings</div>
        </div>
      </div>

      {/* Popular Destinations */}
      <div className="bg-white rounded-2xl p-6 shadow-lg border border-gray-100">
        <h3 className="font-bold text-lg mb-4 flex items-center gap-2">
          <Zap className="w-5 h-5 text-yellow-500" />
          Quick Destinations
        </h3>
        <div className="grid grid-cols-2 gap-2">
          {popularDestinations.map((dest, idx) => (
            <button
              key={idx}
              onClick={() => setRideRequest({...rideRequest, to: dest.name})}
              className="px-4 py-3 bg-gradient-to-r from-gray-50 to-gray-100 rounded-xl text-sm font-medium hover:from-blue-50 hover:to-purple-50 hover:text-blue-700 transition-all border border-gray-200 hover:border-blue-300 text-left"
            >
              <div className="flex items-center justify-between">
                <span>{dest.name}</span>
                <span className="text-xs text-gray-500">{dest.rides} rides</span>
              </div>
            </button>
          ))}
        </div>
      </div>

      {/* Safety Features */}
      <div className="bg-gradient-to-br from-green-50 to-emerald-50 rounded-2xl p-6 border-2 border-green-200">
        <h3 className="font-bold text-lg mb-4 text-green-800 flex items-center gap-2">
          <Shield className="w-6 h-6" />
          Safety First
        </h3>
        <div className="space-y-3">
          {[
            'Verified student profiles with college ID',
            'Real-time GPS tracking & ride sharing',
            'Emergency SOS button with instant alerts',
            'Trusted driver ratings & reviews'
          ].map((feature, idx) => (
            <div key={idx} className="flex items-start gap-3">
              <div className="w-6 h-6 bg-green-500 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
                <svg className="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                </svg>
              </div>
              <span className="text-sm text-gray-700 font-medium">{feature}</span>
            </div>
          ))}
        </div>
      </div>
    </div>
  );

  const ResultsView = () => (
    <div className="space-y-4">
      <div className="flex items-center justify-between mb-4">
        <button 
          onClick={() => setCurrentView('home')}
          className="text-blue-600 hover:text-blue-700 flex items-center gap-1 font-semibold"
        >
          ← Back
        </button>
        <h2 className="font-bold text-xl">Available Rides</h2>
        <div className="w-16"></div>
      </div>

      <div className="bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl p-4 border-2 border-blue-200">
        <div className="flex items-center gap-3">
          <div className="flex-1">
            <div className="flex items-center gap-2 text-sm text-gray-600 mb-1">
              <MapPin className="w-4 h-4" />
              {rideRequest.from}
            </div>
            <div className="flex items-center gap-2 text-sm text-gray-600">
              <Navigation className="w-4 h-4" />
              {rideRequest.to}
            </div>
          </div>
          <div className="text-right">
            <div className="text-sm text-gray-600">{rideRequest.time || 'Now'}</div>
            <div className="text-sm font-semibold text-blue-600">{rideRequest.seats} seat(s)</div>
          </div>
        </div>
      </div>

      <div className="text-sm text-gray-600 font-medium">
        {availableRides.length} rides found
      </div>

      {availableRides.map(ride => (
        <div key={ride.id} className="bg-white rounded-2xl p-5 border-2 border-gray-100 hover:border-blue-300 transition-all shadow-lg hover:shadow-xl">
          <div className="flex items-start justify-between mb-4">
            <div className="flex items-center gap-3">
              <div className="w-14 h-14 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-bold text-lg shadow-md">
                {ride.driver.split(' ').map(n => n[0]).join('')}
              </div>
              <div>
                <div className="font-bold text-lg flex items-center gap-2">
                  {ride.driver}
                  {ride.verified && (
                    <svg className="w-5 h-5 text-blue-500" fill="currentColor" viewBox="0 0 20 20">
                      <path fillRule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                    </svg>
                  )}
                </div>
                <div className="flex items-center gap-2 text-sm text-gray-600">
                  <Star className="w-4 h-4 text-yellow-500 fill-yellow-500" />
                  <span className="font-semibold">{ride.rating}</span>
                  <span>• {ride.totalTrips} trips</span>
                </div>
              </div>
            </div>
            <div className="text-right">
              <div className="text-3xl font-bold bg-gradient-to-r from-green-600 to-emerald-600 bg-clip-text text-transparent">
                ₹{ride.fare}
              </div>
              <div className="text-xs text-gray-500 font-medium">per person</div>
            </div>
          </div>

          <div className="space-y-2.5 mb-4 bg-gray-50 rounded-xl p-4">
            <div className="flex items-center gap-2 text-sm">
              <Clock className="w-4 h-4 text-blue-600" />
              <span className="font-semibold">Departure:</span>
              <span className="text-gray-700">{ride.time}</span>
            </div>
            <div className="flex items-center gap-2 text-sm">
              <Car className="w-4 h-4 text-purple-600" />
              <span className="text-gray-700">{ride.vehicle}</span>
            </div>
            <div className="flex items-center gap-2 text-sm">
              <Navigation className="w-4 h-4 text-orange-600" />
              <span className="text-gray-700">{ride.route}</span>
            </div>
            <div className="flex items-center justify-between text-sm">
              <div className="flex items-center gap-2">
                <Users className="w-4 h-4 text-green-600" />
                <span className="text-gray-700">{ride.availableSeats} seats left</span>
              </div>
              <div className="text-gray-600">
                {ride.distance} • {ride.duration}
              </div>
            </div>
          </div>

          <button 
            onClick={() => handleBookRide(ride)}
            className="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3.5 rounded-xl font-bold hover:from-blue-700 hover:to-purple-700 transition-all shadow-md hover:shadow-lg flex items-center justify-center gap-2"
          >
            Book This Ride
            <ArrowRight className="w-5 h-5" />
          </button>
        </div>
      ))}
    </div>
  );

  const MyRidesView = () => (
    <div className="space-y-4">
      <h2 className="font-bold text-2xl mb-4">My Rides</h2>
      
      {myRides.length === 0 ? (
        <div className="bg-white rounded-2xl p-16 text-center border-2 border-dashed border-gray-300">
          <Car className="w-20 h-20 text-gray-300 mx-auto mb-4" />
          <h3 className="font-bold text-xl text-gray-600 mb-2">No rides booked yet</h3>
          <p className="text-gray-500 mb-6">Start your journey by booking your first ride</p>
          <button 
            onClick={() => setCurrentView('home')}
            className="bg-gradient-to-r from-blue-600 to-purple-600 text-white px-8 py-3 rounded-xl font-semibold hover:from-blue-700 hover:to-purple-700 transition-all shadow-lg"
          >
            Find Rides Now
          </button>
        </div>
      ) : (
        myRides.map(ride => (
          <div key={ride.bookingId} className="bg-white rounded-2xl p-6 border-2 border-green-200 shadow-lg">
            <div className="flex items-center justify-between mb-4">
              <span className="bg-green-100 text-green-700 px-4 py-1.5 rounded-full text-sm font-bold flex items-center gap-1">
                <svg className="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                  <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                </svg>
                Confirmed
              </span>
              <span className="text-sm text-gray-500 font-mono">#{ride.bookingId}</span>
            </div>

            <div className="flex items-center gap-3 mb-4 pb-4 border-b border-gray-200">
              <div className="w-14 h-14 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-bold text-lg shadow-md">
                {ride.driver.split(' ').map(n => n[0]).join('')}
              </div>
              <div className="flex-1">
                <div className="font-bold text-lg">{ride.driver}</div>
                <div className="text-sm text-gray-600">{ride.vehicle}</div>
              </div>
              <div className="text-right">
                <div className="text-2xl font-bold text-green-600">₹{ride.fare}</div>
                <div className="text-xs text-gray-500">× {ride.passengerCount}</div>
              </div>
            </div>

            <div className="space-y-3 mb-4 bg-gray-50 rounded-xl p-4">
              <div className="flex items-start gap-3">
                <MapPin className="w-5 h-5 text-blue-600 mt-0.5" />
                <div className="flex-1">
                  <div className="text-xs text-gray-500 font-medium mb-1">PICKUP</div>
                  <div className="font-semibold">{ride.pickupPoint}</div>
                </div>
              </div>
              <div className="flex items-start gap-3">
                <Navigation className="w-5 h-5 text-purple-600 mt-0.5" />
                <div className="flex-1">
                  <div className="text-xs text-gray-500 font-medium mb-1">DROP</div>
                  <div className="font-semibold">{ride.to}</div>
                </div>
              </div>
              <div className="flex items-center gap-3">
                <Clock className="w-5 h-5 text-orange-600" />
                <div>
                  <span className="font-semibold">{ride.time}</span>
                  <span className="text-gray-500 text-sm ml-2">• Booked at {ride.bookedAt}</span>
                </div>
              </div>
            </div>

            <div className="grid grid-cols-2 gap-3">
              <button className="bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 rounded-xl hover:from-blue-700 hover:to-purple-700 transition-all font-semibold flex items-center justify-center gap-2 shadow-md">
                <Phone className="w-4 h-4" />
                Call Driver
              </button>
              <button className="bg-gray-100 text-gray-700 py-3 rounded-xl hover:bg-gray-200 transition-all font-semibold flex items-center justify-center gap-2">
                <Navigation className="w-4 h-4" />
                Track Live
              </button>
            </div>
          </div>
        ))
      )}
    </div>
  );

  const ProfileView = () => (
    <div className="space-y-4">
      <h2 className="font-bold text-2xl mb-4">Profile</h2>
      
      <div className="bg-gradient-to-br from-blue-600 to-purple-600 rounded-2xl p-8 text-white text-center shadow-xl">
        <div className="w-24 h-24 bg-white bg-opacity-20 backdrop-blur-lg rounded-full flex items-center justify-center text-3xl font-bold mx-auto mb-4 shadow-lg border-4 border-white border-opacity-30">
          AS
        </div>
        <h3 className="font-bold text-2xl">Aman Singh</h3>
        <p className="text-blue-100 text-sm mt-1">B.Tech CSE, 3rd Year</p>
        <p className="text-blue-200 text-sm">Roll No: 2021BCS001</p>
        <div className="flex items-center justify-center gap-2 mt-4 bg-white bg-opacity-20 backdrop-blur-lg rounded-full px-4 py-2 inline-flex">
          <Star className="w-5 h-5 text-yellow-300 fill-yellow-300" />
          <span className="font-bold text-lg">4.9</span>
          <span className="text-blue-100 text-sm">(23 rides)</span>
        </div>
      </div>

      <div className="bg-white rounded-2xl p-6 shadow-lg border border-gray-100">
        <h3 className="font-bold text-lg mb-5 flex items-center gap-2">
          <TrendingDown className="w-5 h-5 text-purple-600" />
          Your Impact
        </h3>
        <div className="grid grid-cols-2 gap-4">
          <div className="text-center p-5 bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl border border-blue-200">
            <Calendar className="w-6 h-6 text-blue-600 mx-auto mb-2" />
            <div className="text-3xl font-bold text-blue-600">23</div>
            <div className="text-sm text-blue-700 font-medium mt-1">Total Rides</div>
          </div>
          <div className="text-center p-5 bg-gradient-to-br from-green-50 to-green-100 rounded-xl border border-green-200">
            <DollarSign className="w-6 h-6 text-green-600 mx-auto mb-2" />
            <div className="text-3xl font-bold text-green-600">₹1,420</div>
            <div className="text-sm text-green-700 font-medium mt-1">Money Saved</div>
          </div>
          <div className="text-center p-5 bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl border border-purple-200">
            <Shield className="w-6 h-6 text-purple-600 mx-auto mb-2" />
            <div className="text-3xl font-bol